# 关于分库分表
### 场景
当数据库存储遇到高并发时候，首先想到**读写分离**，高并发有可能意味着数据量大，大量数据库的查询或者更新操作集中在一张大表，锁的频繁使用导致访问速度下降，此时涉及到分库分表。
### 个人观点
分库分表是一项大工程，面临*如何切分？分布式ID如何获取？事务一致性问题？扩容方式？*等问题。针对小型互联网公司的引用，个人建议优先方案升级数据库硬件如升级SSD|内存等方案。针对中型互联网公司，用户、订单、交易可能会遇到，但随着NoSql兴起，用户大都通过accessToken和NoSql进行校验，订单交易通过冷热数据分离来解决。
### 数据库切分
1. **垂直切分**
垂直切分是指按照业务将表进行分类，将其分布到不同的数据库上，这样就将数据分担到了不同的库上（专库专用）。
> **优点：**
- 拆分后业务清晰，拆分规则明确。
- 系统之间进行整合或扩展很容易。
- 按照成本、应用的等级、应用的类型等将表放到不同的机器上，便于管理。
- 便于实现动静分离、冷热分离的数据库表的设计模式。
- 数据维护简单。
>** 缺点**
- 部分业务表无法关联（Join），只能通过接口方式解决，提高了系统的复杂度。
- 受每种业务的不同限制，存在单库性能瓶颈，不易进行数据扩展和提升性能。
- 事务处理复杂。
1. **水平切分**
就是将表中的某些行切分到一个数据库表中，而将其他行切分到其他数据库表中。这种切分方式根据单表的数据量的规模来切分，保证单表的容量不会太大，从而保证了单表的查询等处理能力
> **优点**
- 单库单表的数据保持在一定的量级，有助于性能的提高。
- 表结构完全相同，应用层改动少，仅需增加路由规则
- 提供系统稳定性和负载能力
> **缺点**
- 数据分散，很难利用数据库join操作，跨库Join性能差
- 切分规则难以抽象
- 分片事务的一致性难以解决

### 分布算法
1. MD5哈希
做法是对UID进行md5加密，然后取前几位，然后就可以将不同的UID哈希到不同的用户表（user_xx）中了。
```javascript
function getTable( $uid ){
  $ext = substr ( md5($uid) ,0 ,2 );
  return "user_".$ext;
}
```
1. 取模
即找到某个字段，这个字段通过取模后的值尽可能平均，根据字段取模的方式决定数据落在哪张表

### 事务处理机制

### 扩容方式


