## 背景
高并发业务场景，对DB压力非常大，缓存用来分担请求对DB的压力，那么必定设计到缓存和数据库存储双写的问题，容易出现 **缓存(Redis)和数据库（MySQL）间的数据一致性问题。**  
个人观点缓存注意下面两点  
>1. **缓存必须设置TTL**  
```
缓存数据在系统中的命中率越高说明性能越好。假设缓存没有设置TTL，它的命中率低，这就会浪费缓存空间。如果有设置TTL，并且命中率高，我们可以在每次命中的时候刷新TTL，就可以保证热点数据一直在缓存中提高系统的性能。如果出现不一致情况，设置TTL只会出现子缓存不一致开始到TTL结束这段时间。
```
>2. **系统保证数据库和缓存数据的最终一致性，无需追求强一致性。**  
```
缓存和数据库属于独立的系统，如果系统要求强一致性，就需要2PC或者Paxos等分布式协议，或者分布式锁，但实现还是有难度并且会影响系统性能，这是需要权衡的。
```
## 缓存数据库读写顺序
>1. **经典方案Cache Aside Pattern**  
```
1. 数据读取：先读取缓存，如果缓存没有命中，再读取数据库，同时将数据库值存入缓存
2. 数据更新：先更新数据库，再删除缓存
```
>2. 先更新数据库，再更新缓存。  
```
主要是并发场景下，多个线程同时更新数据库，由于网络原因后面请求的线程先完成更新操作可能导致数据库数据不是最新的。第二个问题更新缓存的值可能是经过一系列计算得到的，而且数据不常命中频繁更新会影响系统性能。
```